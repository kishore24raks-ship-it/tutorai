{
  "entities": {
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents a user profile in the TutorAI application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user profile."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "name": {
          "type": "string",
          "description": "Full name of the user."
        }
      },
      "required": [
        "id",
        "email",
        "name"
      ]
    },
    "Quiz": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Quiz",
      "type": "object",
      "description": "Represents a quiz generated by the application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the quiz."
        },
        "topic": {
          "type": "string",
          "description": "Topic of the quiz."
        },
        "numberOfQuestions": {
          "type": "number",
          "description": "Number of questions in the quiz."
        },
        "difficulty": {
          "type": "string",
          "description": "Difficulty level of the quiz (e.g., easy, medium, hard)."
        },
        "userProfileId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N Quiz)"
        }
      },
      "required": [
        "id",
        "topic",
        "numberOfQuestions",
        "difficulty",
        "userProfileId"
      ]
    },
    "QuizResult": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "QuizResult",
      "type": "object",
      "description": "Represents the result of a quiz taken by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the quiz result."
        },
        "quizId": {
          "type": "string",
          "description": "Reference to Quiz. (Relationship: Quiz 1:N QuizResult)"
        },
        "userProfileId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N QuizResult)"
        },
        "score": {
          "type": "number",
          "description": "Score obtained in the quiz."
        },
        "completionDate": {
          "type": "string",
          "description": "Date and time when the quiz was completed.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "quizId",
        "userProfileId",
        "score",
        "completionDate"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userProfileId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores user profile data.  Uses path-based ownership for access control.",
          "params": [
            {
              "name": "userProfileId",
              "description": "The unique identifier for the user profile, corresponding to the Firebase Auth UID."
            }
          ]
        }
      },
      {
        "path": "/users/{userProfileId}/quizzes/{quizId}",
        "definition": {
          "entityName": "Quiz",
          "schema": {
            "$ref": "#/backend/entities/Quiz"
          },
          "description": "Stores quiz data associated with a specific user. Uses path-based ownership for access control.",
          "params": [
            {
              "name": "userProfileId",
              "description": "The unique identifier for the user profile, corresponding to the Firebase Auth UID."
            },
            {
              "name": "quizId",
              "description": "The unique identifier for the quiz."
            }
          ]
        }
      },
      {
        "path": "/users/{userProfileId}/quiz_results/{quizResultId}",
        "definition": {
          "entityName": "QuizResult",
          "schema": {
            "$ref": "#/backend/entities/QuizResult"
          },
          "description": "Stores quiz result data associated with a specific user. Uses path-based ownership for access control.",
          "params": [
            {
              "name": "userProfileId",
              "description": "The unique identifier for the user profile, corresponding to the Firebase Auth UID."
            },
            {
              "name": "quizResultId",
              "description": "The unique identifier for the quiz result."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support the TutorAI application's features, including user authentication, quiz generation, and result tracking.  The structure emphasizes Authorization Independence by avoiding `get()` calls in security rules, which is achieved by adhering to the principle of ownership and denormalization. User profiles, quizzes, and quiz results are organized under the `/users/{userId}` path to leverage path-based ownership. This enables simple and robust security rules based on `request.auth.uid`. Quiz and QuizResult documents are stored as subcollections under the UserProfile to ensure that only the authenticated user can access their own data. This structure supports the required QAPs by ensuring that list operations are secure, as access to quizzes and quiz results is restricted to the owning user via the hierarchical path structure."
  }
}